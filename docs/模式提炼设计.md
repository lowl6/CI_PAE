# CI-PAE 扶贫经验模式提炼设计

> 一句话：我们把“钱和项目做了什么”+“县里怎么跟进”+“指标有没有变”+“人怎么评价”串起来，形成可更新的经验模式。

## 1. 总体框架（先看全景）
模式提炼是一个反复循环，而不是一次性写总结：
1. 看投入：政策、资金、受益人结构。 
2. 看落地：哪些县采纳，什么时候采纳，力度如何。 
3. 看变化：经济/农业/基础设施等指标前后有没有真实改善。 
4. 看声音：访谈里大家怎么说（协同？困难？收益？担忧？）。 
5. 做关联：把“指标变化”+“访谈机制词”合成一个强度分。 
6. 提炼模式：挑出既有效又机制清晰的做法，做成可复制单元。

循环含义：新访谈/新年度指标一加入，分数和模式描述就能自动刷新，不用重写一遍研究报告。

---
## 2. 我们存的核心数据（一个表一句话）
| 我们存什么 | 表 | 用来干嘛 |
|-------------|----|-----------|
| 县的基本档案 | `counties` | 哪些地方参与，后面所有指标都按县算 |
| 政策基本信息 | `policies` | 有什么政策、发布时间、类型、摘要 |
| 资源投入细项 | `policy_resources` | 这条政策实打实投了什么（金额、人数、类别）|
| 县与政策的连线 | `rel_policy_county` | 哪个县采纳了，采纳年份，力度分值（strength）|
| 各类发展指标 | 多张 `*_indicators` | GDP、收入、耕地、路网、教育、医疗等变化 |
| 访谈事件 | `interview_events` | 什么时候在哪儿聊了什么主题 |
| 访谈原始内容 | `interview_data` | 具体说了什么、关键词、经验总结 |
| 参与人身份 | `interviewees` | 干部/农户/合作社等角色标签 |
| 研究者记录 | `researchers` / 关联表 | 谁采的这次访谈数据，保证来源清晰 |
| 政策关键词 | `policy_keywords` | 抽取的核心词（带权重），为后面匹配访谈准备 |
| **匹配缓存** | `policy_interview_cache` | **提前算好政策与访谈的关联**（见下详细说明）|
| 汇总视图 | `v_policy_stats` | 一站式取"覆盖数、资源数、访谈数、平均强度"等 |

### 2.1 政策访谈关联缓存表详解（`policy_interview_cache`）
这张表是性能优化的关键，避免每次查询都跨多表模糊匹配。

**字段构成**：
- `policy_id` + `data_id`：联合主键，锁定哪条政策关联哪条访谈记录
- `county_id`：关联发生的县域（通过受访者所在县确定）
- `relevance_score`：相关度评分（0-10），分值越高越相关
- `matched_keywords`：命中的关键词列表（逗号分隔），用于展示和解释
- `updated_at`：最后更新时间戳，支持增量刷新

**计算逻辑（自动填充）**：
1. **县域预筛选**：只关联"政策覆盖县"与"该县受访者参与的访谈"（通过 `rel_policy_county` → `interviewees` → `interview_events` 连线）
2. **关键词匹配**：从 `policy_keywords` 读取该政策的核心词，逐个检查是否出现在：
   - 访谈的 `keywords` 字段（人工标注或半自动抽取）
   - 访谈的 `content` 字段（原始文本）
3. **评分公式**：`相关度 = (匹配关键词数 × 1.5) + 3.0`
   - 基础分 3.0：表示地理关联（同一县域）
   - 每命中一个关键词加 1.5 分
   - 示例：命中 2 个关键词 → 3.0 + 2×1.5 = 6.0 分
4. **关键词列表**：用 `GROUP_CONCAT` 拼接所有命中的词，方便前端高亮显示

**服务层使用策略（policyService.js）**：
- **第一优先**：用关键词精准匹配（包括政策类型、policy_keywords表词、或从政策名/摘要自动抽取的高频词）
  - 匹配位置：`interview_events.topic`（权重 3）、`interview_data.keywords`（权重 2）、`interview_data.content`（权重 1）
  - 返回高相关度访谈（`relevance_score` 降序）
- **第二补充**：若高分访谈不足，从政策覆盖县域的所有访谈中补充（排除已匹配的），限制 30 条
- **合并展示**：关键词匹配的在前，县域相关的在后，保证既精准又全面

**维护时机**：
- 初次导入：运行迁移脚本 `add_policy_enhancements.sql` 批量生成
- 增量更新：新增访谈或政策关键词变化时，重新执行 INSERT ... ON DUPLICATE KEY UPDATE
- 性能提升：避免前端每次请求都做多表 LIKE 查询，查询速度提升 5-10 倍

**设计价值**：
- 让"政策详情-相关访谈"秒开，不卡顿
- 关键词列表可直接用于前端高亮或标签展示
- 评分支持按相关度排序，优先展示最有价值的访谈证据

---
## 3. 六层逻辑怎么读（每层三个问题）
### 3.1 投入层：钱和资源流向
要看什么：金额、受益人数、类别、年份、影响等级。 
为什么看：判断是不是“撒胡椒面”还是“聚焦重点”；识别启动期与巩固期。 
用到的表：`policy_resources`。

### 3.2 采纳层：县域跟进情况
要看什么：哪些县加入、什么时候加入、力度（strength）。 
为什么看：区分试点与扩散，找“滞后县”作为对照。 
用到的表：`rel_policy_county`（含 `adopt_year`、`strength`）。

### 3.3 效应层：指标有没有动
要看什么：政策前后窗口的 GDP、收入、耕地、道路、学校、床位等均值变化。 
为什么看：把“感觉好”换成“数字确实有提升”。 
用到的表：各类 `*_indicators` + 脚本里前后期加权计算逻辑。

### 3.4 机制层：访谈说了什么
要看什么：协同、培训、市场、风险、品牌、困难等关键词与原文片段。 
为什么看：补充指标无法解释的运行方式与主观体感。 
用到的表：`interview_events`、`interview_data`、`interviewees`、`rel_interviewee_event`。

### 3.5 关联层：打综合分
要看什么：指标加权结果 + 访谈关键词命中 + 负面词惩罚。 
为什么看：做成可比较的强度值（避免只看覆盖数量）。 
用到的表/视图：`rel_policy_county`（写回 strength）、`policy_interview_cache`、`policy_keywords`、`v_policy_stats`。

### 3.6 模式层：总结块状经验
要看什么：一个模式的名字、资源结构、扩散曲线、关键机制词、风险点、可复制条件。 
为什么看：把分散数据变成“别人能一眼看懂并复用”的做法包。 
来源组合：政策表 + 资源聚合 + 县采纳 + 指标变化 + 访谈高频词。

模式字段示例：模式名称 / 资源占比 / 采纳节奏 / 指标变化 / 机制词 / 约束词 / 可复制前提 / 强度 / 证据计数。

---
## 4. 这些设计背后的简单理由
| 原则 | 我们怎么做 | 好处 |
|------|------------|------|
| 分层拆开 | 政策/资源/访谈/指标分不同表 | 增减模块不影响其它部分 |
| 关键词锚点 | 给政策设权重词 | 语料能被程序抓到并打分 |
| 前后窗口 | 看发布前后平均值对比 | 避免单一年份异常扰动 |
| 结果缓存 | 预算访谈匹配 | 查询速度快、前端加载稳定 |
| 分值限幅 | 强度用上下界包住 | 极端数据不破坏排名 |
| 多视角机制 | 受访者带身份标签 | 看到“谁说了什么”而不是单声道 |
| 可迭代 | 新数据只需刷新视图和缓存 | 维护成本低 |
| 可复制字段 | 把模式拆成标准字段 | 方便跨地区横向比较 |

---
## 5. 怎么从数据推到“模式”（四类常用句式）
### 5.1 资源结构 → 机制类型
如果资金比重大部分在“培训/服务”，访谈里出现“技术员常驻”“标准化”，我们就标记为“能力驱动型”。
如果投入集中在“基础设施+市场”，同时多人提“物流快”“订单稳”，标记为“市场接入型”。

### 5.2 指标变化 → 效应支撑
GDP 与农村收入都在涨、粮食产量也提升：说明“产业链延伸”可能有效。
宽带用户与公路里程同步提升，访谈里说“信息对接快”：说明“数字+交通协同”在发挥作用。

### 5.3 访谈语义 → 机制与约束
正向高频词：协同 / 培训 / 市场 / 风险预警 / 品牌 / 数据共享。
约束词：人才缺 / 融资难 / 重复录入 / 季节波动。
我们可以用“正向词次数 ÷（正向+负向词总次数）”粗算一个机制成熟度。 

### 5.4 采纳节奏 → 扩散模式
如果大多数县在发布后 1–2 年就加入 → “快速扩散型”（行政推动强）。
如果加入年份拖得很散 → “渐进渗透型”（依赖本地资源匹配和自我验证）。

---
## 6. 从原始数据到模式（简易流程）
| 步骤 | 做什么 | 用哪些表 | 得到什么 |
|------|--------|----------|----------|
| 1 汇总 | 刷新视图与缓存 | `v_policy_stats` `policy_interview_cache` | 最新统计快照 |
| 2 初筛 | 挑强度高+覆盖广政策 | 视图字段 | 候选列表 |
| 3 词聚合 | 找高频机制词 | 访谈内容+关键词 | 机制词簇 |
| 4 组字段 | 填模式模板 | 多表聚合 | 模式草稿 |
| 5 验证 | 指标与访谈是否一致 | 指标差异+词标签 | 通过/修改标记 |
| 6 发布 | 输出模式 JSON | 草稿清单 | 模式版本 1.x |
| 7 迭代 | 新数据再跑一遍 | 同上 | 升级到 1.x+1 |

---
## 7. 后面可以继续做的事
| 想法 | 目的 | 可能新增内容 |
|------|------|--------------|
| 加情感分析 | 分辨“好用”还是“勉强” | 情感极性、满意度标签 |
| 做因果验证 | 判断不是巧合 | 加入对照县、匹配算法（倾向评分）|
| 风险/弹性模型 | 看遇冲击能否恢复 | 灾害或市场事件+恢复时长表 |
| 关键词自进化 | 省人工维护 | 自动抽取新词+权重校准 |
| 适用度评分 | 帮其它县评估能否复制 | 前置资源/组织条件对比函数 |

---
## 8. 核心逻辑一句话版
强度 = 指标变化分 + 访谈机制命中分（可调权重）。
访谈能被利用 = 给它贴关键词 + 绑定参与角色。
模式好用 = 数据可更新+字段标准化+能横向比较。
迭代闭环 = 新数据 → 刷视图/缓存 → 重算分 → 更新模式版本。

---
## 9. 模式单元 JSON 示例
```json
{
  "pattern_id": "PAT001",
  "pattern_name": "多主体协同型产业扶持",
  "policy_refs": ["POL001", "POL003"],
  "resource_profile": {
    "capital_ratio": 0.55,
    "training_ratio": 0.20,
    "infrastructure_ratio": 0.15,
    "social_support_ratio": 0.10,
    "years_span": "2018-2023"
  },
  "adoption_curve": {"early": 5, "middle": 12, "late": 9},
  "mechanism_terms": ["协同", "培训", "市场渠道", "风险预警"],
  "constraint_terms": ["融资成本", "技术员不足"],
  "indicator_effects": [
    {"indicator": "gdp", "change_pct": 22.4},
    {"indicator": "disp_income_rural", "change_pct": 18.7}
  ],
  "sustainability_signals": {"negative_events_low": true, "post_growth_stable": true},
  "replicability_requirements": ["至少具备本地合作组织", "可获得基础网络与物流"],
  "pattern_strength": 0.82,
  "evidence_sources": {"interviews": 34, "resources": 12, "counties": 18},
  "version": "1.0.0"
}
```

---
## 10. 日常维护四条
1. 新访谈进来：插入事件+内容+受访者 → 跑刷新脚本。 
2. 想调权重：改一个 `weights.json`（以后可加），重新计算即可。 
3. 发布新版本：记录时间+版本号，老版本留档对比。 
4. 看质量：统计缺失值和负面词比例，标记可信度等级。

---
## 11. 最后再用一行总结
我们做的事：把“真实投入 + 县域采纳 + 指标前后 + 访谈说法”压成一个可更新、可比较的模式单元，让经验不再只是文字描述。


